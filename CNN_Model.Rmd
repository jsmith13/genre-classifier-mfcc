---
title: "CNN Model"
author: "Jake Smith"
date: "7/12/2019"
---

Fit a rough convolutional neural network.

The training/validation set components X.train, Y.train, X.validation, and Y.validation are generated by "training_set_preparation.Rmd".

```{r setup, include=FALSE}
require(keras)
require(foreach)
require(dplyr)
```

Each observation is currently in a completely linear (vector) format with the following hierarchy.
The naming scheme is: MFCC.v[octave].[timestamp].[region]

- region (start, mid, end)
  - timestamp (1:998)
    - octave (1:12)

We will reshape the dataset into an array with dimensions [observations(n), region (3), timestamp (998), octave(12)].

```{r}
# working with a small model dataset
load("C:/Users/Jake/Desktop/oneline")
threelines = rbind(oneline, oneline + 1, oneline + 2)
```
```{r}
## reshape the matrix into teh desired hierarchy
# loop through lines in matrix X
descriptors.df <- foreach(i = 1:dim(threelines)[1], .combine = rbind) %do% {
  # bind the descriptors into a dataframe with observation, region, timestamp, and octave encoded as variables
  descriptors.df <- cbind(expand.grid(i, 1:12, 1:998, c("start", "mid", "end")), threelines[i, ])
}

# add column names
colnames(descriptors.df) <- c("observation", "octave", "timepoint", "region", "value")

# reorder the dataframe according to the target hierarchy
# observation > region > timestamp > octave
descriptors.df <- arrange(descriptors.df, observation, region, timestamp, octave)

# build an array from the dataframe
descriptors.array <- array(descriptors.df$value, c(3, 998, 3, 12))
```

